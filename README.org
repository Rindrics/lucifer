#:TITLE: tidyNAS
* これは何か？
* システムの構成
** 蓄積データ統合部分
過去のデータとの連続性を保つために，ここが必要．
*** 今まで溜まっているデータをプログラムで統合する（作業記録を残すため）
*** 野帳形式に変換し，過去の全ての年ごとに出力する（あたかも，最初からその形式で入力されたかのように）
出力名は，datname_Routput.csv
*** シェルスクリプトで，ファイル名から_Routputを消去
*** 今後のデータはその野帳の形式を使用し，git管理下で蓄積していく
*** 異常値が見つかったら，基本的にdatname.csvを更新
万一，過去の蓄積データの再出力が必要になっても，git管理下なので適宜"theirs"と"ours"でマージ可能
** Rパッケージ部分
tidy_fishr

浮魚GのNASの中にあるデータの品質をチェックし，統合データとドキュメント類を出力するパッケージ．
*** 機能と関数イメージ
**** 品質チェック
***** check_colname(): 行名
***** chock_class(): 各行のクラス
***** warn_outliar(): 外れ値の警告．チェック済みを1にしたら，警告抑制．
外れ値は2変量の関係で見る．
**** 統合データ出力
***** 航海データの変形
trans_cruise()

入力に便利なフォーマットを，解析しやすいフォーマットに変形するためにこれが必要．

***** データ統合
build(measdir, otldir, crsdir=opt, range.yr=opt)

チェックを通過したものだけを統合．

チェック通過したかの値を保持しておく．

どれか1つのせいで全体のビルドが失敗しないようにする．

***** データの種類
****** 調査
- 採集
- CTD
- 測定台帳
- 耳石
- 鱗
- 脂質分析
****** 鮮魚等
- 測定台帳
- 耳石
- 鱗
- 脂質分析
**** データ目録を作成
make_list(data, outdir)
**** 入力シート，野帳を生成
make_sheets(outdir)

Imports: XLconnect

**** 要約図表を出力
- make_fig(data, outdir)
- make_table(data, outdir)

Imports: ggplot
**** ドキュメントを作成
make_docs(data, outdir, range)
LaTeX と連携
** CI部分
データ目録等のドキュメントと，実際のデータとの間に乖離を生じさせないため

- データの更新を監視しておく
- データ更新があるたびに上記パッケージの関数群が実行され，統合データとドキュメント類が自動的に出力される．

* ディレクトリ構造
- 航海データ/
  - 2017
  - 2018
    - 6月
      - 採集結果.csv
    - 8月
      - 採集結果.csv
- 測定データ/
  - survey2017.csv
  - survey2018.csv
  - sengyo2017.csv
  - sengyo2018.csv

- CTD/
  - 2017
    - st1.asc
    - st2.asc
    - ...
  - 2018
    - st2.asc
    - st1.asc
    - ...
  - tidyNAS/
    - README
    - I/O設定ファイル
    - figs/
      - Sc-j_blhist.pdf
      - Sc-j_blbw.pdf
      - Sc-j_agehist.pdf
      - Sc-j_hdate.pdf
      - Sc-j_cpue.pdf
      - Sc-a...
      - Ja-m...
      - Sa-m...
      - Et-t...
      - En-j...
  
    - tables/
      - all.pdf
      - 1997.pdf
      - ...
      - 2018.pdf
    - reports/
      - 1997.pdf
      - ...
      - 2018.pdf
      - ...
      - Sc-j.pdf
      - Sa-m.pdf
      - En-j.pdf
      - ...
* プロジェクト
** パッケージ化
** CI化
** 導入
* やらないこと
以下のデータの整備
- CTDデータ（海洋環境Gに任せる）
- NORPAC（生態系変動Gに任せる）
* ご意見をいただきたいこと
意見集約の場をGitHubのIssueに設けます．
- データ形式の使いやすさ（解析のしやすさ，入力のしやすさ，ファイルの見つけやすさ）について
- 各調査の呼称，各県データのサンプル名の規格化について
