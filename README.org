#:TITLE: tidyNAS
* これは何か？
* システムの構成
** Rパッケージ部分
tidy_fishr
浮魚GのNASの中にあるデータの品質をチェックし，統合データとドキュメント類を出力するパッケージ．
*** 機能
**** 品質チェック
***** check_colname(): 行名
***** chock_class(): 各行のクラス
***** warn_outliar(): 外れ値の警告．チェック済みを1にしたら，警告抑制．
外れ値は2変量の関係で見る．
**** 統合データ出力
***** 航海データの変形
入力に便利なフォーマットを，解析しやすいフォーマットに変形するためにこれが必要．
trans_cruise()
***** データ統合
チェックを通過したものだけを統合．
チェック通過したかの値を記録しておく．
どれか1つのせいで全体が失敗しないようにする．
build(measdir, otldir, crsdir=opt, range.yr=opt)
****** 調査
******* 採集
******* CTD
******* 測定台帳
******* 耳石
******* 鱗
******* 脂質分析
****** 鮮魚等
******* 測定台帳
******* 耳石
******* 鱗
******* 脂質分析
**** データ目録を作成
make_list(data, outdir)
**** 入力シート，野帳を生成
Imports: XLconnect
make_sheets(outdir)
**** 要約図表を出力
Imports: ggplot
- make_fig(data, outdir)
- make_table(data, outdir)
**** ドキュメントを作成
LaTeX と連携
make_doc(data, outdir, range)
** CI部分
データの更新を監視し，データ更新があるたびにRプログラムが走るようにしておく．
サーバが必要？もしくはパートさんのPCでmakeしておく．
* ディレクトリ構造
** 航海データ/
*** 2017
*** 2018
**** 6月
- 採集結果.csv
**** 8月
- 採集結果.csv
** 測定データ/
考えうるオプション
- 鮮魚と航海を分けるかどうか? -> 多分，分けたほうが良い
- 魚種別に分けるかどうか -> 分けなくていいのでは？
*** survey2017.csv
*** survey2018.csv
*** sengyo2017.csv
*** sengyo2018.csv
** CTD/
*** 2017
**** st1.asc
**** st2.asc
**** ...
*** 2018
**** st1.asc
**** st2.asc
**** ...
** tidyNAS/
*** README
*** I/O設定ファイル
*** figs/
魚種名の表記
- Sc-j: マサバ
- Sc-a: ゴマサバ
- Ja-m: マアジ
- Sa-m: マイワシ
- Et-t: ウルメイワシ
- En-j: カタクチイワシ

出力するグラフの種類
- 体長組成
- 体長体重関係
- 日齢組成
- 孵化日組成
- CPUEの空間分布
- 水温

*** tables/
- all.pdf
- 1997.pdf
- ...
- 2018.pdf
*** reports/
- 1997.pdf
- ...
- 2018.pdf

- Sc-j.pdf
- ...
- Sa-m.pdf
- En-j.pdf
* プロジェクト
** パッケージ化
** CI化
** 導入
* 新システムへの移行方法
*** 今まで溜まっているデータをプログラムで統合する（作業記録を残すため）
*** 野帳形式に変換し，過去の全ての年ごとに出力する（あたかも，最初からその形式で入力されたかのように）
出力名は，datname_Routput.csv
*** シェルスクリプトで，ファイル名から_Routputを消去
*** 今後のデータはその野帳の形式を使用し，git管理下で蓄積していく
*** 異常値が見つかったら，基本的にdatname.csvを更新
万一，過去の蓄積データの再出力が必要になっても，git管理下なので適宜"theirs"と"ours"でマージ可能
* やらないこと
以下のデータの整備
- CTDデータ（海洋環境Gに任せる）
- NORPAC（生態系変動Gに任せる）
* ご意見をいただきたいこと
意見集約の場をGitHubのIssueに設けます．
** データ形式の使いやすさ（解析のしやすさ，入力のしやすさ，ファイルの見つけやすさ）について
** 各調査の呼称，各県データのサンプル名の規格化について
